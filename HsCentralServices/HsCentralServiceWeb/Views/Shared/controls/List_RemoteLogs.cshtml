@using System
@using CsWpfBase.Ev.Public.Extensions
@using HsCentralServiceWeb._dbs.hsserver.centralservicedb.dataset
@using HsCentralServiceWeb._dbs.hsserver.centralservicedb.tables
@using HsCentralServiceWeb._sys.data
@using HsCentralServiceWeb._sys.hubs.webManagement
@using HsCentralServiceWeb._sys._extensions._razorExtensions
@{
	var db = new CentralServiceDb();
	db.Set_DbProxy<Data.HsServerDirectConnector>();
	db.RemoteLogs.DownloadRows($"SELECT TOP 50 {db.RemoteLogs.DefaultSqlSelector} FROM {RemoteLogsTable.NativeName} ORDER BY [{RemoteLogsTable.CreatedCol}] DESC");
}

@{
	CsAjaxForm csAjaxForm;
}
@using (csAjaxForm = Ajax.Cs().Form("Partial_LogsList", "PartialViews", null))
{
	<div class="col-md-12">
		@if (db.RemoteLogs.Rows.Count == 0)
		{
			<h5>keine remote logs vorhanden</h5>
		}
		else
		{
			<h5>Remote Logs [@db.RemoteLogs.Rows.Count]</h5>
			<div class="table-responsive" style="margin-left: 20px">
				<table class="table table-striped table-sm table-bordered table-hover">
					<thead>
					<tr>
						<th>Created</th>
						<th>Issuer</th>
						<th>Severity</th>
						<th>Title</th>
						<th style="width: 100%">Content</th>
					</tr>
					</thead>
					<tbody>
					@foreach (var log in db.RemoteLogs.OrderByDescending(x => x.Created))
					{
						<tr class="text-justify">
							<td style="white-space: nowrap">@log.Created.ToString("dd.MM.yyyy HH:mm:ss")</td>
							<td style="white-space: nowrap">@log.Issuer</td>
							<td style="white-space: nowrap">@log.Severity.GetName()</td>
							<td style="white-space: nowrap">@log.Title</td>
							<td style="white-space: nowrap">@log.Content</td>
						</tr>
					}
					</tbody>
				</table>
			</div>
		}
	</div>
}
@WwwSurferNotificationHub.Attach_RemoteLogsChanged(csAjaxForm.Id)
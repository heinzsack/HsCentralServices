@using System
@using CsWpfBase.Ev.Public.Extensions
@using CsWpfBase.Global
@using CsWpfBase.Global.remote.services.eventHub
@using HsCentralServiceWeb._sys
@using HsCentralServiceWeb._sys.hubs.webManagement
@using HsCentralServiceWeb._sys._extensions._razorExtensions
@{
	CsAjaxForm csAjaxForm;
	var eventHubListeners = EventHubServer.I.OnGetListeners();
}
@using (csAjaxForm = Ajax.Cs().Form("Partial_ConnectedClients", "PartialViews", null))
{
	<div class="col-md-12">
		@if (eventHubListeners.Length == 0)
		{
			<h5>keine verbundenen Applikationen</h5>
		}
		else
		{
			foreach (var group in eventHubListeners.GroupBy(x=>x.ClientData.ApplicationName).OrderBy(x => x.Key))
			{
				<h5>@group.Key Clients</h5>
				<div class="table-responsive" style="margin-left: 20px">
					<table class="table table-striped table-sm table-bordered table-hover">
						<thead>
						<tr>
							<th>Connected</th>
							<th>Computer</th>
							<th>User</th>
							<th style="width: 100%">Events</th>
						</tr>
						</thead>
						<tbody>
						@foreach (var connection in group.OrderBy(x => x.ClientData.ComputerName))
						{
							<tr class="text-justify">
								<td style="white-space: nowrap">@connection.StartTime.ToString("dd.MM HH:mm:ss")</td>
								<td style="white-space: nowrap">@connection.ClientData.ComputerName</td>
								<td style="white-space: nowrap">@connection.ClientData.UserName</td>
								<td>[@connection.Events.Join("], [")]</td>
							</tr>
						}
						</tbody>
					</table>
				</div>
			}
		}
	</div>
}
@WwwSurferNotificationHub.Attach_ConnectedClientsChanged(csAjaxForm.Id)